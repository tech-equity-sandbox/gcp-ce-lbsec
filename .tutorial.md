## Getting started

Depending on the platform setup, the asset may initialize automatically or may need to be manually executed. To manually execute the asset, run the command `./gcp-ce-lbsec.sh` on the terminal.

When you run the script, it sets up the pre-requisite automation tools behind the scenes. 

Please be patient, and allow a few seconds for the lab to initialize. 

You will be prompted to enter any key to continue once the initialization process is complete.

If the step by step guide is not displayed automatically, enter `G` below the `What additional steps do you want to perform...` prompt.

There are 3 modes of operation. 

Set the mode of operation by selecting option `0` on the menu, and enter your preference from the list below:

- `y` to preview configuration or commands.
- `n` to execute commands in the create mode.
- `d` to delete resources in the delete mode.

Click the **START** button below to continue to the next page.

## Selecting a project

You need to select a project for this lab.

*Hint: You should be the Owner or Editor of this project. We recommend deleting the project at the end of the lab or using the `d` option to delete provisioned resources and avoid incurring additional costs.*

Set the create mode by selecting `0` at the menu, and enter `n` at the prompt.

Click the **NEXT** button to continue.

## Sign in

You need to authenticate to `gcloud` to complete the lab.

Click the link displayed, sign-in using your Google Cloud account, and click the `Allow` button to grant permissions to Google Cloud SDK. 

Click the `Copy` button to copy the authorization code. 

Return to the cloud shell terminal and paste the authorization code into the prompt to authenticate to cloud shell.

Enter a valid Google Cloud project ID at the prompt to confirm the project you intend to use. You must have project owner or editor role privileges on this project.

Enter any key at the `$` prompt to return to the menu, and click the **NEXT** button to continue.

## Configure HTTPs Load Balancing and Cloud Armor 

This asset enables you to configure HTTPs Load Balancing and Cloud Armor.

**Time to complete**: About 60 minutes

**Prerequisites**: You need Project Owner or Editor Role.

### Outline

This asset enables you to perform the following activities:

 - Enable APIs
 - Create compute engine firewall rule
 - Create template and managed instance group 
 - Configure name port 
 - Configure basic healthcheck and backend services
 - Add backend services to instance groups and configure scaling
 - Configure URL map and target http proxy
 - Configure forwarding rules
 - Configure load balancer firewall rule
 - Load test instances using the load balancer
 - Configure security policy
 - Configure managed SSL certificate

Click the **NEXT** button to continue.

## Step 0: Launch step by step guide

Use this option to launch an interactive step by step guide. 

If new to this experience, follow the guide carefully. 

As your experience grows, the need to refer to this guide will diminish, as the lab experience is intuitive.

To enable APIs, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 1: Enable APIs

You need to enable the APIs in the project to perform the required tasks. 

You only need to do this once for your project. 

Enter `1` at the `additional steps to perform` prompt to enable the API.  

Note the list of APIs enabled.

To create compute engine firewall rule, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 2: Create compute engine firewall rule

Enter `2` at the `additional steps to perform` prompt to create compute engine firewall rule.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/networking/firewalls/list?project={{project-id}}` to explore firewall configuration.

To create template and managed instance group, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 3: Create template and managed instance group

Enter `3` at the `additional steps to perform` prompt to create template and managed instance group.

Note the comments associated with each command, and step through the commands.

Navigate to `https://console.cloud.google.com/compute/instanceTemplates/list?project={{project-id}}` to explore instance template configuration.

Navigate to `https://console.cloud.google.com/compute/instanceGroups/list?project={{project-id}}` to explore instance group configuration.

To Configure name port, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 4: Configure name port 

Enter `4` at the `additional steps to perform` prompt to configure name port.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/compute/instanceGroups/list?project={{project-id}}` to explore instance group configuration.

To configure basic healthcheck and backend services, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 5: Configure basic healthcheck and backend services

Enter `5` at the `additional steps to perform` prompt to configure basic healthcheck and backend services.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/net-services/loadbalancing/list/loadBalancers?project={{project-id}}` to explore load balancer configuration.

To add backend services to instance groups and configure scaling, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 6: Add backend services to instance groups and configure scaling

Enter `6` at the `additional steps to perform` prompt to add backend services to instance groups and configure scaling.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/compute/instanceGroups/list?project={{project-id}}` to explore instance group configuration.

To configure URL map and target http proxy, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 7: Configure URL map and target http proxy

Enter `7` at the `additional steps to perform` prompt to configure URL map and target http proxy.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/net-services/loadbalancing/list/loadBalancers?project={{project-id}}` to explore load balancer configuration.

To configure forwarding rules, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 8: Configure forwarding rules

Enter `8` at the `additional steps to perform` prompt to configure forwarding rules.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/net-services/loadbalancing/list/loadBalancers?project={{project-id}}` to explore load balancer configuration.

To configure load balancer firewall rule, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 9: Configure load balancer firewall rule

Enter `9` at the `additional steps to perform` prompt to configure load balancer firewall rule.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/networking/firewalls/list?project={{project-id}}` to explore firewall configuration.

To create load testing instances, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 10: Load test instances using the load balancer

Enter `10` at the `additional steps to perform` prompt to load test instances using the load balancer.

Note the commands and associated comments, and step through the commands.

To configure security policy, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 11: Configure security policy

Enter `11` at the `additional steps to perform` prompt to configure security policy.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/net-security/securitypolicies/list?project={{project-id}}` to explore security policy configuration.

To configure managed SSL certificate, click the **NEXT** button.

Enter any key at the `$` prompt in the cloud shell terminal.

## Step 12: Configure managed SSL certificate

Enter `12` at the `additional steps to perform` prompt to configure managed SSL certificate.

Note the commands and associated comments, and step through the commands.

Navigate to `https://console.cloud.google.com/net-services/loadbalancing/details/http/glbsec-url-map?project={{project-id}}` to explore load balancer SSL configuration.

Congratulations! You have completed the setup

Enter any key at the `$` prompt in the cloud shell terminal.
